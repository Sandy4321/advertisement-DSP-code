DELIMITER $$  
DROP PROCEDURE IF EXISTS base.delRddRule_h;

create PROCEDURE base.delRddRule_h(IN p_itnum tinyint)
BEGIN
    DECLARE  v_day_type varchar(255);
    DECLARE  v_ind_first_industry_name varchar(255);
    DECLARE  v_adg_site_set varchar(255);
    DECLARE  v_adg_product_type varchar(255);
    DECLARE  v_tag_age_1_17 varchar(255);
    DECLARE  v_tag_age_18_23 varchar(255);
    DECLARE  v_tag_age_24_30 varchar(255);
    DECLARE  v_tag_age_31_40 varchar(255);
    DECLARE  v_tag_age_41_50 varchar(255);
    DECLARE  v_tag_age_51_65 varchar(255);
    DECLARE  v_tag_age_66_127 varchar(255);
    DECLARE  v_gender_FEMALE varchar(255);
    DECLARE  v_gender_MALE varchar(255);
    DECLARE  v_region_110000 varchar(255);
    DECLARE  v_region_120000 varchar(255);
    DECLARE  v_region_130000 varchar(255);
    DECLARE  v_region_140000 varchar(255);
    DECLARE  v_region_150000 varchar(255);
    DECLARE  v_region_210000 varchar(255);
    DECLARE  v_region_220000 varchar(255);
    DECLARE  v_region_230000 varchar(255);
    DECLARE  v_region_310000 varchar(255);
    DECLARE  v_region_320000 varchar(255);
    DECLARE  v_region_330000 varchar(255);
    DECLARE  v_region_340000 varchar(255);
    DECLARE  v_region_350000 varchar(255);
    DECLARE  v_region_360000 varchar(255);
    DECLARE  v_region_370000 varchar(255);
    DECLARE  v_region_410000 varchar(255);
    DECLARE  v_region_420000 varchar(255);
    DECLARE  v_region_430000 varchar(255);
    DECLARE  v_region_440000 varchar(255);
    DECLARE  v_region_450000 varchar(255);
    DECLARE  v_region_460000 varchar(255);
    DECLARE  v_region_500000 varchar(255);
    DECLARE  v_region_510000 varchar(255);
    DECLARE  v_region_520000 varchar(255);
    DECLARE  v_region_530000 varchar(255);
    DECLARE  v_region_540000 varchar(255);
    DECLARE  v_region_610000 varchar(255);
    DECLARE  v_region_620000 varchar(255);
    DECLARE  v_region_630000 varchar(255);
    DECLARE  v_region_640000 varchar(255);
    DECLARE  v_region_650000 varchar(255);
    DECLARE  v_region_710000 varchar(255);
    DECLARE  v_region_810000 varchar(255);
    DECLARE  v_region_820000 varchar(255);
    DECLARE  v_buss_1 varchar(255);
    DECLARE  v_buss_2 varchar(255);
    DECLARE  v_buss_3 varchar(255);
    DECLARE  v_buss_4 varchar(255);
    DECLARE  v_buss_5 varchar(255);
    DECLARE  v_buss_6 varchar(255);
    DECLARE  v_buss_7 varchar(255);
    DECLARE  v_buss_8 varchar(255);
    DECLARE  v_buss_9 varchar(255);
    DECLARE  v_buss_10 varchar(255);
    DECLARE  v_buss_11 varchar(255);
    DECLARE  v_buss_12 varchar(255);
    DECLARE  v_buss_13 varchar(255);
    DECLARE  v_buss_14 varchar(255);
    DECLARE  v_buss_15 varchar(255);
    DECLARE  v_buss_16 varchar(255);
    DECLARE  v_buss_21 varchar(255);
    DECLARE  v_buss_25 varchar(255);
    DECLARE  v_ad_space varchar(255);
    DECLARE  v_adc_form_size_type varchar(255);
    DECLARE  v_adc_form_detail varchar(255);
    DECLARE  v_ade_image_hash varchar(255);
    DECLARE  v_ade_title varchar(255);
    DECLARE  v_sql varchar(1000);
    DECLARE  delstr varchar(1000);
		DECLARE  i int;

    DECLARE done INT DEFAULT 0;
   	DECLARE cur_rules CURSOR FOR select day_type,ind_first_industry_name,adg_site_set,adg_product_type,tag_age_1_17,tag_age_18_23,tag_age_24_30,tag_age_31_40,tag_age_41_50,tag_age_51_65,tag_age_66_127,gender_FEMALE,gender_MALE,region_110000,region_120000,region_130000,region_140000,region_150000,region_210000,region_220000,region_230000,region_310000,region_320000,region_330000,region_340000,region_350000,region_360000,region_370000,region_410000,region_420000,region_430000,region_440000,region_450000,region_460000,region_500000,region_510000,region_520000,region_530000,region_540000,region_610000,region_620000,region_630000,region_640000,region_650000,region_710000,region_810000,region_820000,buss_1,buss_2,buss_3,buss_4,buss_5,buss_6,buss_7,buss_8,buss_9,buss_10,buss_11,buss_12,buss_13,buss_14,buss_15,buss_16,buss_21,buss_25,ad_space,adc_form_size_type,adc_form_detail,ade_image_hash,ade_title from comb_advplatform_actopt_corrules_filter where ctr_flag='ctr_h' and item_num=p_itnum;    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done=1;
		
    OPEN cur_rules;
		set i = 0;
    REPEAT
				select i;
        FETCH NEXT from cur_rules INTO v_day_type,v_ind_first_industry_name,v_adg_site_set,v_adg_product_type,v_tag_age_1_17,v_tag_age_18_23,v_tag_age_24_30,v_tag_age_31_40,v_tag_age_41_50,v_tag_age_51_65,v_tag_age_66_127,v_gender_FEMALE,v_gender_MALE,v_region_110000,v_region_120000,v_region_130000,v_region_140000,v_region_150000,v_region_210000,v_region_220000,v_region_230000,v_region_310000,v_region_320000,v_region_330000,v_region_340000,v_region_350000,v_region_360000,v_region_370000,v_region_410000,v_region_420000,v_region_430000,v_region_440000,v_region_450000,v_region_460000,v_region_500000,v_region_510000,v_region_520000,v_region_530000,v_region_540000,v_region_610000,v_region_620000,v_region_630000,v_region_640000,v_region_650000,v_region_710000,v_region_810000,v_region_820000,v_buss_1,v_buss_2,v_buss_3,v_buss_4,v_buss_5,v_buss_6,v_buss_7,v_buss_8,v_buss_9,v_buss_10,v_buss_11,v_buss_12,v_buss_13,v_buss_14,v_buss_15,v_buss_16,v_buss_21,v_buss_25,v_ad_space,v_adc_form_size_type,v_adc_form_detail,v_ade_image_hash,v_ade_title;
        IF not done THEN
	        -- Æ´½Ó¶¯Ì¬sql
	 				set delstr = '';
	 				if v_day_type<>'' then set delstr=concat(delstr, ' and day_type=''', v_day_type, ''''); end if;
	 				if v_ind_first_industry_name<>'' then set delstr=concat(delstr, ' and ind_first_industry_name=''', v_ind_first_industry_name, ''''); end if;
	 				if v_adg_site_set<>'' then set delstr=concat(delstr, ' and adg_site_set=''', v_adg_site_set , ''''); end if;
	 				if v_adg_product_type<>'' then set delstr=concat(delstr, ' and adg_product_type=''', v_adg_product_type , ''''); end if;
	 				if v_tag_age_1_17<>'' then set delstr=concat(delstr, ' and tag_age_1_17=''', v_tag_age_1_17 , ''''); end if;
	 				if v_tag_age_18_23<>'' then set delstr=concat(delstr, ' and tag_age_18_23=''', v_tag_age_18_23, ''''); end if;
	 				if v_tag_age_24_30<>'' then set delstr=concat(delstr, ' and tag_age_24_30=''', v_tag_age_24_30, ''''); end if;
	 				if v_tag_age_31_40<>'' then set delstr=concat(delstr, ' and tag_age_31_40=''', v_tag_age_31_40, ''''); end if;
	 				if v_tag_age_41_50<>'' then set delstr=concat(delstr, ' and tag_age_41_50=''', v_tag_age_41_50, ''''); end if;
	 				if v_tag_age_51_65<>'' then set delstr=concat(delstr, ' and tag_age_51_65=''', v_tag_age_51_65, ''''); end if;
	 				if v_tag_age_66_127<>'' then set delstr=concat(delstr, ' and tag_age_66_127=''', v_tag_age_66_127 , ''''); end if;
	 				if v_gender_FEMALE<>'' then set delstr=concat(delstr, ' and gender_FEMALE=''', v_gender_FEMALE, ''''); end if;
	 				if v_gender_MALE<>'' then set delstr=concat(delstr, ' and gender_MALE=''', v_gender_MALE, ''''); end if;
	 				if v_region_110000<>'' then set delstr=concat(delstr, ' and region_110000=''', v_region_110000, ''''); end if;
	 				if v_region_120000<>'' then set delstr=concat(delstr, ' and region_120000=''', v_region_120000, ''''); end if;
	 				if v_region_130000<>'' then set delstr=concat(delstr, ' and region_130000=''', v_region_130000, ''''); end if;
	 				if v_region_140000<>'' then set delstr=concat(delstr, ' and region_140000=''', v_region_140000, ''''); end if;
	 				if v_region_150000<>'' then set delstr=concat(delstr, ' and region_150000=''', v_region_150000, ''''); end if;
	 				if v_region_210000<>'' then set delstr=concat(delstr, ' and region_210000=''', v_region_210000, ''''); end if;
	 				if v_region_220000<>'' then set delstr=concat(delstr, ' and region_220000=''', v_region_220000, ''''); end if;
	 				if v_region_230000<>'' then set delstr=concat(delstr, ' and region_230000=''', v_region_230000, ''''); end if;
	 				if v_region_310000<>'' then set delstr=concat(delstr, ' and region_310000=''', v_region_310000, ''''); end if;
	 				if v_region_320000<>'' then set delstr=concat(delstr, ' and region_320000=''', v_region_320000, ''''); end if;
	 				if v_region_330000<>'' then set delstr=concat(delstr, ' and region_330000=''', v_region_330000, ''''); end if;
	 				if v_region_340000<>'' then set delstr=concat(delstr, ' and region_340000=''', v_region_340000, ''''); end if;
	 				if v_region_350000<>'' then set delstr=concat(delstr, ' and region_350000=''', v_region_350000, ''''); end if;
	 				if v_region_360000<>'' then set delstr=concat(delstr, ' and region_360000=''', v_region_360000, ''''); end if;
	 				if v_region_370000<>'' then set delstr=concat(delstr, ' and region_370000=''', v_region_370000, ''''); end if;
	 				if v_region_410000<>'' then set delstr=concat(delstr, ' and region_410000=''', v_region_410000, ''''); end if;
	 				if v_region_420000<>'' then set delstr=concat(delstr, ' and region_420000=''', v_region_420000, ''''); end if;
	 				if v_region_430000<>'' then set delstr=concat(delstr, ' and region_430000=''', v_region_430000, ''''); end if;
	 				if v_region_440000<>'' then set delstr=concat(delstr, ' and region_440000=''', v_region_440000, ''''); end if;
	 				if v_region_450000<>'' then set delstr=concat(delstr, ' and region_450000=''', v_region_450000, ''''); end if;
	 				if v_region_460000<>'' then set delstr=concat(delstr, ' and region_460000=''', v_region_460000, ''''); end if;
	 				if v_region_500000<>'' then set delstr=concat(delstr, ' and region_500000=''', v_region_500000, ''''); end if;
	 				if v_region_510000<>'' then set delstr=concat(delstr, ' and region_510000=''', v_region_510000, ''''); end if;
	 				if v_region_520000<>'' then set delstr=concat(delstr, ' and region_520000=''', v_region_520000, ''''); end if;
	 				if v_region_530000<>'' then set delstr=concat(delstr, ' and region_530000=''', v_region_530000, ''''); end if;
	 				if v_region_540000<>'' then set delstr=concat(delstr, ' and region_540000=''', v_region_540000, ''''); end if;
	 				if v_region_610000<>'' then set delstr=concat(delstr, ' and region_610000=''', v_region_610000, ''''); end if;
	 				if v_region_620000<>'' then set delstr=concat(delstr, ' and region_620000=''', v_region_620000, ''''); end if;
	 				if v_region_630000<>'' then set delstr=concat(delstr, ' and region_630000=''', v_region_630000, ''''); end if;
	 				if v_region_640000<>'' then set delstr=concat(delstr, ' and region_640000=''', v_region_640000, ''''); end if;
	 				if v_region_650000<>'' then set delstr=concat(delstr, ' and region_650000=''', v_region_650000, ''''); end if;
	 				if v_region_710000<>'' then set delstr=concat(delstr, ' and region_710000=''', v_region_710000, ''''); end if;
	 				if v_region_810000<>'' then set delstr=concat(delstr, ' and region_810000=''', v_region_810000, ''''); end if;
	 				if v_region_820000<>'' then set delstr=concat(delstr, ' and region_820000=''', v_region_820000, ''''); end if;
	 				if v_buss_1<>'' then set delstr=concat(delstr, ' and buss_1=''', v_buss_1, ''''); end if;
	 				if v_buss_2<>'' then set delstr=concat(delstr, ' and buss_2=''', v_buss_2, ''''); end if;
	 				if v_buss_3<>'' then set delstr=concat(delstr, ' and buss_3=''', v_buss_3, ''''); end if;
	 				if v_buss_4<>'' then set delstr=concat(delstr, ' and buss_4=''', v_buss_4, ''''); end if;
	 				if v_buss_5<>'' then set delstr=concat(delstr, ' and buss_5=''', v_buss_5, ''''); end if;
	 				if v_buss_6<>'' then set delstr=concat(delstr, ' and buss_6=''', v_buss_6, ''''); end if;
	 				if v_buss_7<>'' then set delstr=concat(delstr, ' and buss_7=''', v_buss_7, ''''); end if;
	 				if v_buss_8<>'' then set delstr=concat(delstr, ' and buss_8=''', v_buss_8, ''''); end if;
	 				if v_buss_9<>'' then set delstr=concat(delstr, ' and buss_9=''', v_buss_9, ''''); end if;
	 				if v_buss_10<>'' then set delstr=concat(delstr, ' and buss_10=''', v_buss_10, ''''); end if;
	 				if v_buss_11<>'' then set delstr=concat(delstr, ' and buss_11=''', v_buss_11, ''''); end if;
	 				if v_buss_12<>'' then set delstr=concat(delstr, ' and buss_12=''', v_buss_12, ''''); end if;
	 				if v_buss_13<>'' then set delstr=concat(delstr, ' and buss_13=''', v_buss_13, ''''); end if;
	 				if v_buss_14<>'' then set delstr=concat(delstr, ' and buss_14=''', v_buss_14, ''''); end if;
	 				if v_buss_15<>'' then set delstr=concat(delstr, ' and buss_15=''', v_buss_15, ''''); end if;
	 				if v_buss_16<>'' then set delstr=concat(delstr, ' and buss_16=''', v_buss_16, ''''); end if;
	 				if v_buss_21<>'' then set delstr=concat(delstr, ' and buss_21=''', v_buss_21, ''''); end if;
          if v_buss_25<>'' then set delstr=concat(delstr, ' and buss_25=''', v_buss_25, ''''); end if;
          if v_ad_space<>'' then set delstr=concat(delstr, ' and ad_space=''', v_ad_space, ''''); end if;
          if v_adc_form_size_type<>'' then set delstr=concat(delstr, ' and adc_form_size_type=''', v_adc_form_size_type, ''''); end if;
          if v_adc_form_detail<>'' then set delstr=concat(delstr, ' and adc_form_detail=''', v_adc_form_detail, ''''); end if;
          if v_ade_image_hash<>'' then set delstr=concat(delstr, ' and ade_image_hash=''', v_ade_image_hash, ''''); end if;
          if v_ade_title<>'' then set delstr=concat(delstr, ' and ade_title=''', v_ade_title, ''''); end if;

					set v_sql = concat('delete from comb_advplatform_actopt_corrules_filter where ctr_flag = ''ctr_h'' and item_num > ', p_itnum, delstr, ';');
					select v_sql;
					set @sql = v_sql;
					PREPARE s1 from @sql;
					EXECUTE s1;
					deallocate prepare s1; 

        END IF; 	 				
				set i = i+1;
    UNTIL done END REPEAT;   
    CLOSE cur_rules;

END$$

DELIMITER ;